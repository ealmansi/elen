<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: binary64.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: binary64.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/***
 * @license
 * https://github.com/ealmansi/elen
 * Copyright (c) 2017 Emilio Almansi
 * Distributed under the MIT software license, see the accompanying
 * file LICENSE or http://www.opensource.org/licenses/mit-license.php.
 */

const MAX_EXPONENT = 2047
const MAX_MANTISSA = 4503599627370495

/**
 * Constructs a JavaScript number given the values for the sign, exponent,
 * and mantissa in its binary64 representation.
 * 
 * @param {object} - Containing: sign, exponent, mantissa.  
 */
function construct({ sign, exponent, mantissa }) {
  const buffer = new ArrayBuffer(8)
  const floatArray = new Float64Array(buffer)
  const intArray = new Uint8Array(buffer)
  set_sign(sign, intArray)
  set_exponent(exponent, intArray)
  set_mantissa(mantissa, intArray)
  return floatArray[0]
}

/**
 * Returns an object with the values for the sign, exponent, and mantissa
 * in the binary64 representation of the number n.
 * 
 * @param {number} n 
 * @returns {object}
 * @throws {InvalidArgumentException}
 */
function deconstruct(n) {
  const buffer = new ArrayBuffer(8)
  const floatArray = new Float64Array(buffer)
  const intArray = new Uint8Array(buffer)
  floatArray[0] = n
  return {
    sign: getSign(intArray),
    exponent: getExponent(intArray),
    mantissa: getMantissa(intArray),
  }
}

function getSign(intArray) {
  return intArray[7] >> 7
}

function set_sign(sign, intArray) {
  intArray[7] |= (sign &lt;&lt; 7)
}

function getExponent(intArray) {
  let r = 0
  r += (intArray[7] &amp; 0x7F) &lt;&lt; 4
  r += intArray[6] >> 4
  return r
}

function set_exponent(exponent, intArray) {
  intArray[7] |= exponent >> 4
  intArray[6] |= (exponent &amp; 0xF) &lt;&lt; 4
}

function getMantissa(intArray) {
  let r = 0
  r += (intArray[6] &amp; 0x0F) * Math.pow(2, 48)
  r += intArray[5] * Math.pow(2, 40)
  r += intArray[4] * Math.pow(2, 32)
  r += intArray[3] * Math.pow(2, 24)
  r += intArray[2] * Math.pow(2, 16)
  r += intArray[1] * Math.pow(2, 8)
  r += intArray[0]
  return r
}

function set_mantissa(mantissa, intArray) {
  intArray[6] |= (mantissa / Math.pow(2, 48)) &amp; 0xFF
  intArray[5] |= (mantissa / Math.pow(2, 40)) &amp; 0xFF
  intArray[4] |= (mantissa / Math.pow(2, 32)) &amp; 0xFF
  intArray[3] |= (mantissa / Math.pow(2, 24)) &amp; 0xFF
  intArray[2] |= (mantissa / Math.pow(2, 16)) &amp; 0xFF
  intArray[1] |= (mantissa / Math.pow(2, 8)) &amp; 0xFF
  intArray[0] |= mantissa &amp; 0xFF
}

module.exports = { MAX_EXPONENT, MAX_MANTISSA, construct, deconstruct }
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#construct">construct</a></li><li><a href="global.html#decode">decode</a></li><li><a href="global.html#deconstruct">deconstruct</a></li><li><a href="global.html#encode">encode</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Dec 17 2017 04:10:18 GMT-0300 (-03)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
